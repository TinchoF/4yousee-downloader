<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<title>Outcon</title>
	</head>
	<body style="margin:0; padding:0">
		<div id='divShow'></div>
	</body>
	<script>
		window.getProjectJSON = "designer"
		let player;
		let id;
		let content;
		let filename;
		let video;
		function fetch(url){
			return new Promise((resolve, reject) => {
				let xmlhttp = new XMLHttpRequest();
				xmlhttp.onreadystatechange = ()=>{
					if(xmlhttp.status < 200 && xmlhttp.status >=300){
						reject(xmlhttp.status);
						return;
					}
					if (xmlhttp.readyState == 4 ){
						resolve(xmlhttp.responseText);
					}
				}
				xmlhttp.open("GET", url, true);
				xmlhttp.send();
			});
		}

		async function load(){
			player = await fetch("http://localhost:48567/api/player/status");
			id;
			if (player) id = JSON.parse(player).player.id;
			else id = 0;
			content = JSON.parse(await fetch("http://test.outcondigital.com:8048/ad/get?player="+id+"&publisher=5d5d66f2306ea4114a37c7c2&demo=true"));//Publisher Outcon test
			let f = decodeURIComponent(content.creatives[0].url).split('/');
			filename = f[f.length-1];
			if (content.status == 'error' || id == 0) {
				document.getElementById("divShow").innerHTML = '<img style="margin: 0; padding: 0; width: 100%; height: 100%; margin: 0px; padding: 0px"; src="../outcon/downloads/default.jpeg">';
			}
			else {
				if (content.type == "video"){
					document.getElementById("divShow").innerHTML = '<video muted autoplay id="video"; style="margin: 0; padding: 0; width: 100%; height: 100%; margin: 0px; padding: 0px" ><source src="../outcon/downloads/'+filename+'"></video>';
					video = document.getElementById("video");
					video.pause();
					video.currentTime = 0;
					}
				if (content.type == "banner"){
					document.getElementById("divShow").innerHTML = '<img style="margin: 0; padding: 0; width: 100%; height: 100%; margin: 0px; padding: 0px"; src="../outcon/downloads/'+filename+'">';
				}
			}
			fetch(content.trackingURL);
			setTimeout(function(){ Android.ready(init)}, 5000);
		}

		function init(){
			if (content.type == "video"){	
				let video = document.getElementById("video");
				video.play();
				video.onended = function() {Android.finish()};
				}
			if (content.type == "banner"){
				setTimeout(function(){ Android.finish();}, 10000);
			}
		}
		load();
	</script>
</html>

